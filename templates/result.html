<!doctype html>
<html lang="ko">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>카페인 수혈 결과물 페이지</title>
    <!--    아이콘을 위한 링크 -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <script src="https://kit.fontawesome.com/acbb32aeb8.js" crossorigin="anonymous"></script>
    <!--    한글 폰트-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <!--캡쳐 이벤트 위한 css-->

{#    <style>#}
{##}
{#        #screenshot_background {#}
{#            width: 100%;#}
{#            height: 100%;#}
{#            position: fixed;#}
{#            top: 0px;#}
{#            left: 0px;#}
{#            display: block;#}
{#            opacity: 0.3;#}
{#            text-align: center;#}
{#            box-sizing: border-box;#}
{#            z-index: 2147483647;#}
{#            border-color: black;#}
{#            border-style: solid;#}
{#        }#}
{##}
{#        /* 캡쳐 영역만 밝게 하기 위한 요소 */#}
{#        #screenshot:before, #screenshot:after {#}
{#            border: none !important;#}
{#            content: "" !important;#}
{#            height: 100% !important;#}
{#            position: absolute !important;#}
{#            width: 100% !important#}
{#        }#}
{##}
{#        #screenshot:before {#}
{#            border-right: 1px solid white !important;#}
{#            border-bottom: 1px solid white !important;#}
{#            left: -100% !important;#}
{#            top: -100% !important#}
{#        }#}
{##}
{#        #screenshot:after {#}
{#            border-top: 1px solid white !important;#}
{#            border-left: 1px solid white !important;#}
{#            left: 0 !important;#}
{#            top: 0 !important#}
{#        }#}
{##}
{#        #screenshot {#}
{#            height: 100% !important;#}
{#            position: fixed !important;#}
{#            width: 100% !important;#}
{#            z-index: 2147483648 !important#}
{#        }#}
{##}
{#        /* 캡쳐 시 마우스 커서 모양 변경 */#}
{#        body.edit_cursor {#}
{#            cursor: crosshair;#}
{#        }#}
{##}
{#    </style>#}


</head>
<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <div id="main">
        <div class="inner">
            <!-- Header -->
            <header id="header">
                <a href="http://127.0.0.1:8000/caffeine/result/" class="logo"><strong>Result Page</strong> by Caffeine
                    Intoxication</a>
                <ul class="icons">
                    <li class="nav-item">
                        {% if user.is_authenticated %}
                            <a class="nav-link" href="{% url 'logout' %}">{{ user.username }} (로그아웃)</a>
                        {% else %}
                            <a class="nav-link" href="{% url 'login' %}">로그인</a>
                        {% endif %}
                    </li>
                    <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
                    <li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a></li>
                    <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
                </ul>
            </header>
            <!--                content -->
            <section>
<!--id = video start-->
<!--            좌 우 품을 행 시작-->
                <div class = "row">
<!--            좌측 div 시작-->
                    <div class = "col-6 col-12-small" style="width: 70%;">
                        <span id="video" >
                            <h2> Lecture Name : <span style="color:#ff3e33">{{ movie_title }}<span>  </h2>
                            <iframe id="youtube" width="100%" height="500" src={{ embed_url }} title = "YouTube video player"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen></iframe>

                        </span>
        <!--                video end-->
                    </div>
<!--                 비디오 오른쪽에 배치할 div-->
                <div class = "col-6 col-12-small" style="width: 30%; height : 500px; overflow:auto;">
                    <button id="capture_button" class="button small" onclick="getxy()" type="button">캡쳐</button>
                    <button id="img_to_text" class="button small" onclick="code_to_text()" type="button">변환</button>

                    <div id="screenshot"> <!--캡쳐 이미지 띄울 div-->
                        <p>이곳에 이미지 띄울 자리임.</p>
                        <br><br><br><br><br>
                    </div> <!--캡쳐 이미지 띄울 div end-->
                    <div id="code_box"><!-- text변환한거 띄울 div-->
                        <p>이곳에 text 변환한거 띄울 거임</p>
                        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                    </div> <!--code_box end-->

                </div> <!-- 오른쪽 div end-->

                </div> <!--row div end-->
                <script>
                        function code_to_text() {
                            $.ajax({
                                url: 'http://127.0.0.1:8000/caffeine/code_to_text/',
                                method: 'POST',
                                }).then(function (response) {
                                    $('#code_box').html(response[0]);
                                    // var code_text = '';
                                    // for ( var i = 0 ; i<4 ; i++ ){
                                    //      code_text = code_text + response[i];
                                    // }
                                    // $('#code_box').html(code_text);
                                });
                        } //codetotext()끝
                </script>
                <div class="box">
                    <div class="box">
                        <div class="h-100 p-5 text-white bg-dark rounded-3">
                            <h2>강의 전문</h2>
                            <div id="loading1" style="margin-left: 0px; display: none;">
                                <h4>강의 전문 추출중...</h4>
                            </div>
                            <div id="textall" style="margin-left: 0px; display: none;">
                            </div>
                            <button id="button1" class="button" onclick="text()" type="button">1. 동영상
                                STT 추출
                            </button>
                            <script>
                                function text() {
                                    $('#loading1').show();
                                    $.ajax({
                                        url: 'http://127.0.0.1:8000/caffeine/text/',
                                        method: 'POST',
                                    }).then(function (response) {
                                        $('#loading1').hide();
                                        $('#textall').show();
                                        $('#textall').html(response.text_all);
                                        $('#textall').css("height", "768px");
                                        $('#textall').css("overflow" , "auto");
                                        $('#button1').hide();
                                    });
                                }
                            </script>
                        </div>
                    </div>

                    <div class="box">
                        <div class="h-100 p-5 text-white bg-dark rounded-3">
                            <h2>강의 요약</h2>
                            <div id="loading2" style="margin-left: 0px; display: none;">
                                <h4>강의 요약중...</h4>
                            </div>
                            <div id="sumall" style="margin-left: 0px; display: none;">
                            </div>
                            <button id="button2" class="button" onclick="summary()"
                                    type="button">2. 요약본 추출
                            </button>
                            <script>
                                function summary() {
                                    $('#loading2').show();
                                    $.ajax({
                                        url: 'http://127.0.0.1:8000/caffeine/summary/',
                                        method: 'POST',
                                    }).then(function (response) {
                                        $('#loading2').hide();
                                        $('#sumall').show();
                                        $('#sumall').html(response.sum_text);
                                        $('#button2').hide();
                                    });
                                }
                            </script>
                        </div>
                    </div>
                </div>

                <div class="box">
                    <div class="box">
                        <div class="h-100 p-5 text-white bg-dark rounded-3">
                            <h2>키워드 추출</h2>
                            <div id="loading3" style="margin-left: 0px; display: none;">
                                <h4>키워드 추출중...</h4>
                            </div>
{#                            <div id="keyword" style="margin-left: 0px; display: none;">#}
{#                            </div>#}
                            <div id="plot_box" class="box">
                                {# 동글이 자리#}
                            </div>
                            <button id="button3" class="button" onclick="keytext()" type="button">
                                3.키워드 추출
                            </button>
                        </div>
                    </div>

                    <div class="box">
                        <div class="h-100 p-5 text-white bg-dark rounded-3">
                            <h2>빈칸 문제</h2>
                            <div class="box" id="loading4" style="margin-left: 0px; display: none;">
                                <h4>문제 생성중...</h4>
                            </div>
                            <div class="box" id="exercise" style="margin-left: 0px; display: none;">
                            </div>
                            <button id="button4" class="btn btn-outline-secondary" onclick="showanswer()"
                                    type="button" style="display: none;">4. 정답확인
                            </button>
                            <div class="box" id="answer" style="margin-left: 0px; display: none;"></div>
                        </div>
                    </div>
                    <button id="button_save" class="button" onclick="savedb()" type="button">4.저장</button>
                </div>
                <!--            section content end-->
            </section>
            <!-- inner end -->
        </div>
        <!--main end-->
    </div>
    <!--        side bar start-->
    <div id="sidebar">
        <div class="inner">

            <!-- Search -->
            <section id="search" class="alt">
                <form method="post" action="#">
                    <input type="text" name="query" id="query" placeholder="Search"/>
                </form>
            </section>

            <!-- Menu -->
            <nav id="menu">
                <header class="major">
                    <h2>Menu</h2>
                </header>
                <ul>
                    <li><a href="http://127.0.0.1:8000/caffeine/">NEW SUMMARIZE</a></li>
                    <li><a href="http://127.0.0.1:8000/caffeine/board/">HISTORY</a></li>
{#                    <li><a href="#">??</a></li>#}

                </ul>
            </nav>

            <!-- Section -->
            <section>
                <header class="major">
                    <h2>Get in touch</h2>
                </header>
                <p>영어로 강의 문제 없어요!!!</p>
                <ul class="contact">
                    <li class="icon solid fa-envelope"><a href="#">information@caffeine.ac.kr</a></li>
                    <li class="icon solid fa-phone">(010) 1234-5678</li>
                    <li class="icon solid fa-home">30, Pildong-ro 1-gil, Jung-gu, Seoul, Republic of Korea
                        02-2260-0000
                    </li>
                </ul>
            </section>

            <!-- Footer -->
            <footer id="footer">

                <p class="copyright">&copy; Caffeine. All rights reserved.<br>
                    Design: <a href="https://html5up.net">HTML5 UP</a>
                </p>
            </footer>
            <!--inner end-->
        </div>
        <!--    sidebar end-->
    </div>
    <!--wrapper end-->
</div>

</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    function keytext() {
        $('#loading3').show();
        $('#loading4').show();
        $.ajax({
            url: 'http://127.0.0.1:8000/caffeine/keytext/',
            method: 'POST',
            data: {'text': $('#textall').html()}
        }).then(function (response) {
            $('#loading3').hide();
            $('#loading4').hide();
            $('#keyword').show();
            $('#keyword').html(response.keyword);
            $('#plot_box').html(response.plot_html);
            $('#exercise').html("<p>1번 문제: " + response.sentence_blank1 + "</p>");
            $('#exercise').append("<p>2번 문제: " + response.sentence_blank2 + "</p>");
            $('#exercise').append("<p>3번 문제: " + response.sentence_blank3 + "</p>");
            $('#exercise').append("<p>4번 문제: " + response.sentence_blank4 + "</p>");
            $('#exercise').append("<p>5번 문제: " + response.sentence_blank5 + "</p>");
            $('#exercise').show();
            $('#answer').html("<p>1번 답:&nbsp"+response.answer1 +"<br>"+ response.sentence1 + "</p>");
            $('#answer').append("<p>2번 답:&nbsp"+response.answer2 +"<br>"+ response.sentence2 + "</p>");
            $('#answer').append("<p>3번 답:&nbsp"+response.answer3 +"<br>"+ response.sentence3 + "</p>");
            $('#answer').append("<p>4번 답:&nbsp"+response.answer4 +"<br>"+ response.sentence4 + "</p>");
            $('#answer').append("<p>5번 답:&nbsp"+response.answer5 +"<br>"+ response.sentence5 + "</p>");
            $('#button3').hide();
            $('#button4').show();
        });
    }
</script>
<!--캡쳐 마우스 이벤트 시작-->


<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>

{#<script>#}
    {#window.onload = function () {#}
    {#    // 캡쳐 버튼 클릭 이벤트 등록#}
    {#    document.getElementById("edit").addEventListener("click", function (e) {#}
    {#        // 마우스 커서 모양 변경 (eidt_cursor 클래스 추가)#}
    {#        document.querySelector("body").classList.add("edit_cursor");#}
    {#        screenshot(e);#}
    {#    });#}
    {#}#}
    {##}
    {#/*#}
    {#*#}
    {#*/#}
    {#function screenshot(e) {#}
    {#    var startX, startY;#}
    {#    var height = window.innerHeight;#}
    {#    var width = window.innerWidth;#}
    {##}
    {#    // 배경을 어둡게 깔아주기 위한 div 객체 생성#}
    {#    var $screenBg = document.createElement("div");#}
    {#    $screenBg.id = "screenshot_background";#}
    {#    $screenBg.style.borderWidth = "0 0 " + height + "px 0";#}
    {##}
    {#    // 마우스 이동하면서 선택한 영역의 크기를 보여주기 위한 div 객체 생성#}
    {#    var $screenshot = document.createElement("div");#}
    {#    $screenshot.id = "screenshot";#}
    {##}
    {#    document.querySelector("body").appendChild($screenBg);#}
    {#    document.querySelector("body").appendChild($screenshot);#}
    {##}
    {#    var selectArea = false;#}
    {#    var body = document.querySelector('body');#}
    {##}
    {#    // 마우스 누르는 이벤트 함수#}
    {#    var mousedown = function (e) {#}
    {#        e.preventDefault();#}
    {#        selectArea = true;#}
    {#        startX = e.clientX;#}
    {#        startY = e.clientY;#}
    {#        // 이벤트를 실행하면서 이벤트 삭제 (한번만 동작하도록)#}
    {#        body.removeEventListener("mousedown", mousedown);#}
    {#    }#}
    {#    // 마우스 누르는 이벤트 등록#}
    {#    body.addEventListener("mousedown", mousedown);#}
    {##}
    {#    // 클릭한 마우스 떼는 이벤트 함수#}
    {#    var mouseup = function (e) {#}
    {#        selectArea = false;#}
    {#        // (초기화) 마우스 떼면서 마우스무브 이벤트 삭제#}
    {#        body.removeEventListener("mousemove", mousemove);#}
    {#        // (초기화) 스크린샷을 위해 생성한 객체 삭제#}
    {#        $screenshot.parentNode.removeChild($screenshot);#}
    {#        $screenBg.parentNode.removeChild($screenBg);#}
    {#        var x = e.clientX;#}
    {#        var y = e.clientY;#}
    {#        var top = Math.min(y, startY);#}
    {#        var left = Math.min(x, startX);#}
    {#        var width = Math.max(x, startX) - left;#}
    {#        var height = Math.max(y, startY) - top;#}
    {#        html2canvas(document.body).then(#}
    {#            function (canvas) { //전체 화면 캡쳐#}
    {#                // 선택 영역만큼 crop#}
    {#                var img = canvas.getContext('2d').getImageData(left, top, width, height);#}
    {#                var c = document.createElement("canvas");#}
    {#                c.width = width;#}
    {#                c.height = height;#}
    {#                c.getContext('2d').putImageData(img, 0, 0);#}
    {#                save(c); // crop한 이미지 저장#}
    {#            }#}
    {#        );#}
    {#        body.removeEventListener("mouseup", mouseup);#}
    {#        // 마우스 커서 기본으로 변경#}
    {#        document.querySelector("body").classList.remove("edit_cursor");#}
    {#    }#}
    {#    body.addEventListener("mouseup", mouseup);#}
    {##}
    {#    // 마우스무브 이벤트 함수#}
    {#    function mousemove(e) {#}
    {#        var x = e.clientX;#}
    {#        var y = e.clientY;#}
    {#        $screenshot.style.left = x;#}
    {#        $screenshot.style.top = y;#}
    {#        if (selectArea) { //캡쳐 영역 선택 그림#}
    {#            var top = Math.min(y, startY);#}
    {#            var right = width - Math.max(x, startX);#}
    {#            var bottom = height - Math.max(y, startY);#}
    {#            var left = Math.min(x, startX);#}
    {#            $screenBg.style.borderWidth = top + 'px ' + right + 'px ' + bottom + 'px ' + left + 'px';#}
    {#        }#}
    {#    }#}
    {##}
    {#    body.addEventListener("mousemove", mousemove);#}
    {##}
    {#    // 캡쳐한 이미지 저장#}
    {#    function save(canvas) {#}
    {#        if (navigator.msSaveBlob) {#}
    {#            var blob = canvas.msToBlob();#}
    {#            return navigator.msSaveBlob(blob, '파일명.jpg');#}
    {#        } else {#}
    {#            var el = document.getElementById("target");#}
    {#            el.href = canvas.toDataURL("image/jpeg");#}
    {#            el.download = '파일명.jpg';#}
    {#            el.click();#}
    {#        }#}
    {#    }#}
    {#}#}
{#</script>#}


<!--캡쳐 마우스 드래그 이벤트 끝-->
<script>
    function savedb() {
        $.ajax({
            url: 'http://127.0.0.1:8000/caffeine/savedb/',
            method: 'POST',
        }).then(function (response) {
            $('#button_save').hide();
            alert(response)
        });
    } //save db끝

    function getxy() {

        var target = document.getElementById("youtube");

        var y_up = window.pageYOffset + target.getBoundingClientRect().top;
        var y_down = window.pageYOffset +  target.getBoundingClientRect().bottom;
        var x_left = target.getBoundingClientRect().left;
        var x_right = target.getBoundingClientRect().right;

        // var y_up = target.getBoundingClientRect().top;
        // var y_down = target.getBoundingClientRect().bottom;
        // var x_left = target.getBoundingClientRect().left;
        // var x_right = target.getBoundingClientRect().right;

        // let y_up = $('#youtube').offset().top;
        // let y_down = $('#youtube').offset().top + $('#youtube').outerHeight();
        // let x_right = $('#youtube').offset().left + $('#youtube').outerWidth();
        // let x_left = $('#youtube').offset().left;
        console.log(window.pageYOffset, x_left, y_up, x_right, y_down);
        $.ajax({
            url: 'http://127.0.0.1:8000/caffeine/getxy/',
            method: 'POST',
            data : {'x_left': x_left, 'y_up': y_up, 'x_right': x_right, 'y_down':y_down}
        }).then(function (response) {
            alert(response)
        });

    } //getxy 끝
</script>

<script>
    function showanswer() {
        $('#answer').show();
        $('#button4').hide();
    }
</script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/browser.min.js' %}"></script>
<script src="{% static 'js/breakpoints.min.js' %}"></script>
<script src="{% static 'js/util.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>

<!--<script> //이미지 복사 스크립트-->
<!--    document.addEventListener('DOMContentLoaded', function () {-->
<!--        document.addEventListener('paste', function (evt) {-->
<!--            const clipboardItems = evt.clipboardData.items;-->
<!--            const items = [].slice.call(clipboardItems).filter(function (item) {-->
<!--                // Filter the image items only-->
<!--                return item.type.indexOf('image') !== -1;-->
<!--            });-->
<!--            if (items.length === 0) {-->
<!--                return;-->
<!--            }-->

<!--            const item = items[0];-->
<!--            const blob = item.getAsFile();-->

<!--            const imageEle = document.getElementById('preview');-->
<!--            imageEle.src = URL.createObjectURL(blob);-->

<!--            //unique한 파일명을 위한 날짜 생성 함수 date to str-->
<!--            Date.prototype.YYYYMMDDHHMMSS = function(){-->
<!--                var yyyy = this.getFullYear().toString();-->
<!--                var MM = pad(this.getMonth() + 1,2);-->
<!--                var dd = pad(this.getDate(), 2);-->
<!--                var hh = pad(this.getHours(), 2);-->
<!--                var mm = pad(this.getMinutes(), 2);-->
<!--                var ss = pad(this.getSeconds(), 2);-->

<!--                return (yyyy + mm + dd + hh + mm + ss );-->
<!--            };-->

<!--            function pad(number, length) {-->
<!--                var str = '' + number;-->
<!--                while (str.length<length){-->
<!--                    str = '0' + str;-->
<!--                }-->
<!--                return str;-->
<!--            }-->

<!--            var nowDate = new Date().YYYYMMDDHHMMSS();-->
<!--            var filename = nowDate + '.jpeg';-->
<!--            blob.name = filename;-->
<!--            //날짜 끝-->

<!--            //blob -> file 객체 생성 (저장 필요..)-->
<!--            const myFile = new File( [blob], filename, {-->
<!--                type : blob.type,-->
<!--            });-->

<!--            // {#imgpost(myFile);#}-->
<!--            imgpost(myFile);-->

<!--            // 내 컴퓨터에 다운 받는 방법-->
<!--            let link = document.createElement('a');-->
<!--            link.download = filename;-->
<!--            link.href = URL.createObjectURL(blob);-->
<!--            link.click();-->
<!--            // 내 컴퓨터 다운 끝-->

<!--        });-->
<!--    });-->
<!--</script>-->

<!--<script>-->
<!--    function imgpost(file) {-->
<!--        $.ajax({-->
<!--            url: 'http://127.0.0.1:8000/caffeine/imgpost/',-->
<!--            method: 'POST',-->
<!--            data : {"img": file}-->
<!--        })-->
<!--    }-->
<!--</script>-->


</html>